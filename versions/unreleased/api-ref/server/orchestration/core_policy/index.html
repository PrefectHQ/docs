
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.prefect.io/latest/api-ref/server/orchestration/core_policy/">
      
      
        <link rel="prev" href="../policies/">
      
      
        <link rel="next" href="../global_policy/">
      
      
        
      
      
      <link rel="icon" href="../../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21+insiders-4.39.0">
    
    
      
        <title>server.orchestration.core_policy - Prefect Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.02b45acc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ecc776e4.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/theme.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/admonitions.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/api_ref.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/rest_ref.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/syntax_highlights.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/termynal.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    

      
  


  <script src="../../../../assets/external/cdn.amplitude.com/libs/analytics-browser-1.9.1-min.js.gz.js"></script>
<script type="text/javascript">
const amplitudeKey = "c97dd2acbf306ab7bf54aca0aeb7ffa1"
const amplitudeUrl = "/2/httpapi"

const addUrl = (event) => {
  const deviceId = amplitude.getDeviceId()
  const { href = '' } = event.target
  const url = new URL(href)
  url.searchParams.append('deviceId', deviceId)
  event.target.href = url.toString()
}

const removeUrl = (event) => {
  const { href = '' } = event.target
  const url = new URL(href)
  url.searchParams.delete('deviceId')
  event.target.href = url.toString()
}

const urls = [
  'https://app.prefect.cloud',
  'https://app.stg.prefect.dev',
  'https://app.prefect.dev',
]

const selector = urls.map((url) => `a[href^="${url}"]`).join(',')

const addDeviceIdToAppLinks = () => {
  const elements = document.querySelectorAll(selector)

  elements.forEach((element) => {
    element.addEventListener('mouseenter', addUrl)
    element.addEventListener('mouseleave', removeUrl)
    element.addEventListener('focus', addUrl)
    element.addEventListener('blur', removeUrl)
    element.addEventListener('touchstart', addUrl)
    element.addEventListener('touchend', removeUrl)
  })
}


const init = () => {
  amplitude.init(amplitudeKey, undefined, {
    useBatch: true,
    serverUrl: amplitudeUrl,
    attribution: {
      disabled: false,
      trackNewCampaigns: true,
      trackPageViews: true,
      resetSessionOnNewCampaign: true,
    },
    defaultTracking: {
      pageViews: {
        trackOn: function() { return true},
        eventType: "Page View: Docs",
        trackHistoryChanges: "all",
      },
      sessions: false,
      formInteractions: true,
      fileDownloads: true,
    },
  })
}

function trackPageView() {
  amplitude.track(
    'Page View: Docs',
    {
      'url': window.href,
      'title': document.title,
      'referrer': document.referrer,
      'path': window.location.pathname
    }
  )
}

if (amplitudeKey){
  document.addEventListener("DOMContentLoaded", function() {
      init()
      setTimeout(addDeviceIdToAppLinks)
      setTimeout(trackPageView)
  });
}
</script>


  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-3M31G9B0QJ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-3M31G9B0QJ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-3M31G9B0QJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    

    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="server.orchestration.core_policy - Prefect Docs" />
<meta property="og:image" content="https://docs.prefect.io/latest/assets/images/social/api-ref/server/orchestration/core_policy.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://docs.prefect.io/latest/api-ref/server/orchestration/core_policy/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter.title" content="server.orchestration.core_policy - Prefect Docs" />
<meta property="twitter:image" content="https://docs.prefect.io/latest/assets/images/social/api-ref/server/orchestration/core_policy.png" />
</head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prefect.server.orchestration.core_policy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
              </button>
            
            

          </div>
          
            <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're viewing the docs for Prefect unreleased.
  <a href="../../../../.."> 
    <strong>Click here to view the latest docs.</strong>
  </a>

  <script type="text/javascript">
    // extract the version from the URL
    var version = window.location.pathname.split('/')[1];
    console.log("version is latest!")
    // check if the version is 'latest'
    var showVersionBanner = version !== 'latest';
    
    // hide the announcement bar if we're not showing the latest version of the docs
    // wait until dom is loaded
    document.addEventListener("DOMContentLoaded", function(event) {
      if (showVersionBanner) {
        document.querySelector('[data-md-component="announce"]').setAttribute('hidden', '');
      }
    });
  </script>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Prefect Docs" class="md-header__button md-logo" aria-label="Prefect Docs" data-md-component="logo">
      
  <img src="../../../../img/logos/prefect-logo-gradient-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Prefect Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              server.orchestration.core_policy
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
              </label>
            
          
        </form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PrefectHQ/prefect" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Prefect Docs" class="md-nav__button md-logo" aria-label="Prefect Docs" data-md-component="logo">
      
  <img src="../../../../img/logos/prefect-logo-gradient-white.svg" alt="logo">

    </a>
    Prefect Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PrefectHQ/prefect" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../.." class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33L23 7.5m-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79.28 1.18M1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38l5.87-3.88Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_1">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../tutorial/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 17c-.14 0-.26 0-.39.04L17.5 13.8c.45-.45.75-1.09.75-1.8a2.5 2.5 0 0 0-2.5-2.5c-.14 0-.25 0-.4.04L13.74 6.3c.47-.46.76-1.09.76-1.8a2.5 2.5 0 0 0-5 0c0 .7.29 1.34.76 1.79L8.65 9.54c-.15-.04-.26-.04-.4-.04a2.5 2.5 0 0 0-2.5 2.5c0 .71.29 1.34.75 1.79l-1.61 3.25C4.76 17 4.64 17 4.5 17a2.5 2.5 0 0 0 0 5A2.5 2.5 0 0 0 7 19.5c0-.7-.29-1.34-.76-1.79l1.62-3.25c.14.04.26.04.39.04s.25 0 .38-.04l1.63 3.25c-.47.45-.76 1.09-.76 1.79a2.5 2.5 0 0 0 5 0A2.5 2.5 0 0 0 12 17c-.13 0-.26 0-.39.04L10 13.8c.45-.45.75-1.09.75-1.8 0-.7-.29-1.33-.75-1.79l1.61-3.25c.13.04.26.04.39.04s.26 0 .39-.04L14 10.21a2.5 2.5 0 0 0 1.75 4.29c.13 0 .25 0 .38-.04l1.63 3.25c-.47.45-.76 1.09-.76 1.79a2.5 2.5 0 0 0 5 0 2.5 2.5 0 0 0-2.5-2.5m-15 3.5c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m8.5-1c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1M7.25 12c0-.55.45-1 1-1s1 .45 1 1-.45 1-1 1-1-.45-1-1M11 4.5c0-.55.45-1 1-1s1 .45 1 1-.45 1-1 1-1-.45-1-1m3.75 7.5c0-.55.45-1 1-1s1 .45 1 1-.45 1-1 1-1-.45-1-1m4.75 8.5c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Tutorial
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorial
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorial/flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorial/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorial/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Deploying Flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../guides/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/deployment/storage-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/deployment/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/upgrade-guide-agents-to-workers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Upgrade from Agents to Workers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/deployment/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/deployment/helm-worker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Kubernetes Worker with Helm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/deployment/push-work-pools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Serverless Push Work Pools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://prefecthq.github.io/prefect-aws/#using-prefect-with-aws-ecs" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Run a flow on AWS ECS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/deployment/aci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Azure Container Instance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/deployment/developing-a-new-worker-type/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Custom Workers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Profiles & Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/runtime-context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Runtime Context
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Variables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/webhooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Webhooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/state-change-hooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    State Change Hooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/dask-ray-task-runners/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Dask & Ray
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../guides/host/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Hosting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../recipes/recipes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Recipes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../concepts/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.33 12.91c.09 1.55-.62 3.04-1.89 3.95l.77 1.49c.23.45.26.98.06 1.45-.19.47-.58.84-1.06 1l-.79.25a1.687 1.687 0 0 1-1.86-.55L14.44 18c-.89-.15-1.73-.53-2.44-1.1-.5.15-1 .23-1.5.23-.88 0-1.76-.27-2.5-.79-.53.16-1.07.23-1.62.22-.79.01-1.57-.15-2.3-.45a4.105 4.105 0 0 1-2.43-3.61c-.08-.72.04-1.45.35-2.11-.29-.75-.32-1.57-.07-2.33C2.3 7.11 3 6.32 3.87 5.82c.58-1.69 2.21-2.82 4-2.7 1.6-1.5 4.05-1.66 5.83-.37.42-.11.86-.17 1.3-.17 1.36-.03 2.65.57 3.5 1.64 2.04.53 3.5 2.35 3.58 4.47.05 1.11-.25 2.2-.86 3.13.07.36.11.72.11 1.09m-5-1.41c.57.07 1.02.5 1.02 1.07a1 1 0 0 1-1 1h-.63c-.32.9-.88 1.69-1.62 2.29.25.09.51.14.77.21 5.13-.07 4.53-3.2 4.53-3.25a2.592 2.592 0 0 0-2.69-2.49 1 1 0 0 1-1-1 1 1 0 0 1 1-1c1.23.03 2.41.49 3.33 1.3.05-.29.08-.59.08-.89-.06-1.24-.62-2.32-2.87-2.53-1.25-2.96-4.4-1.32-4.4-.4-.03.23.21.72.25.75a1 1 0 0 1 1 1c0 .55-.45 1-1 1-.53-.02-1.03-.22-1.43-.56-.48.31-1.03.5-1.6.56-.57.05-1.04-.35-1.07-.9a.968.968 0 0 1 .88-1.1c.16-.02.94-.14.94-.77 0-.66.25-1.29.68-1.79-.92-.25-1.91.08-2.91 1.29C6.75 5 6 5.25 5.45 7.2 4.5 7.67 4 8 3.78 9c1.08-.22 2.19-.13 3.22.25.5.19.78.75.59 1.29-.19.52-.77.78-1.29.59-.73-.32-1.55-.34-2.3-.06-.32.27-.32.83-.32 1.27 0 .74.37 1.43 1 1.83.53.27 1.12.41 1.71.4-.15-.26-.28-.53-.39-.81a1.038 1.038 0 0 1 1.96-.68c.4 1.14 1.42 1.92 2.62 2.05 1.37-.07 2.59-.88 3.19-2.13.23-1.38 1.34-1.5 2.56-1.5m2 7.47-.62-1.3-.71.16 1 1.25.33-.11m-4.65-8.61a1 1 0 0 0-.91-1.03c-.71-.04-1.4.2-1.93.67-.57.58-.87 1.38-.84 2.19a1 1 0 0 0 1 1c.57 0 1-.45 1-1 0-.27.07-.54.23-.76.12-.1.27-.15.43-.15.55.03 1.02-.38 1.02-.92Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Deployments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/work-pools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Work Pools & Workers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/schedules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Schedules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/results/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Artifacts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    States
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/blocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Blocks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/task-runners/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Task Runners
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Events
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/automations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Automations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Filesystems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_15" >
        
          <label class="md-nav__link" for="__nav_4_15" id="__nav_4_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Block and Agent-Based Deployments
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    Block and Agent-Based Deployments
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/deployments-block-based/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Deployments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/agents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../cloud/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20m-12-2h12q1.05 0 1.77-.73.73-.72.73-1.77t-.73-1.77Q19.55 13 18.5 13H17v-2q0-2.07-1.46-3.54Q14.08 6 12 6 9.93 6 8.46 7.46 7 8.93 7 11h-.5q-1.45 0-2.47 1.03Q3 13.05 3 14.5q0 1.45 1.03 2.5 1.02 1 2.47 1m5.5-6Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Cloud
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_5">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cloud
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/cloud-quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/workspaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Workspaces
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/organizations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Organizations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../cloud/users/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Users
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_5_5">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Users
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/users/roles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Roles (RBAC)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/users/api-keys/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    API Keys
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/users/service-accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Service Accounts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/users/sso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Single Sign-on (SSO)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/users/audit-log/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Audit Log
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/rate-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    API Rate Limits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/connecting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Connecting & Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../integrations/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 8H2.5a1 1 0 0 0-1 1v5.25a.75.75 0 0 1-1.5 0V9a2.5 2.5 0 0 1 2.5-2.5H4V5.133a1.75 1.75 0 0 1 1.533-1.737l2.831-.353.76-.913c.332-.4.825-.63 1.344-.63h.782c.966 0 1.75.784 1.75 1.75V4h2.25a.75.75 0 0 1 0 1.5H13v4h2.25a.75.75 0 0 1 0 1.5H13v.75a1.75 1.75 0 0 1-1.75 1.75h-.782c-.519 0-1.012-.23-1.344-.63l-.761-.912-2.83-.354A1.75 1.75 0 0 1 4 9.867Zm6.276-4.91-.95 1.14a.753.753 0 0 1-.483.265l-3.124.39a.25.25 0 0 0-.219.248v4.734c0 .126.094.233.219.249l3.124.39a.752.752 0 0 1 .483.264l.95 1.14a.25.25 0 0 0 .192.09h.782a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25h-.782a.25.25 0 0 0-.192.09Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_6">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Using Integrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../integrations/contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Contributing Integrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Zm7.251 10.324.004-5.073-.002-2.253A2.25 2.25 0 0 0 5.003 2.5H1.5v9h3.757a3.75 3.75 0 0 1 1.994.574ZM8.755 4.75l-.004 7.322a3.752 3.752 0 0 1 1.992-.572H14.5v-9h-3.495a2.25 2.25 0 0 0-2.25 2.25Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    API References
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_7">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    API References
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../python/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Python SDK API
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_7_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python SDK API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.artifacts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.context
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.filesystems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/futures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.futures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.infrastructure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_12" >
        
          <label class="md-nav__link" for="__nav_7_2_12" id="__nav_7_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    prefect.deployments
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    prefect.deployments
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/deployments/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.deployments.deployments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/deployments/base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.deployments.base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/deployments/steps/core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.deployments.steps.core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/deployments/steps/pull/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.deployments.steps.pull
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/deployments/steps/utility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.deployments.steps.utility
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_13" >
        
          <label class="md-nav__link" for="__nav_7_2_13" id="__nav_7_2_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    prefect.runtime
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    prefect.runtime
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/runtime/flow_run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.runtime.flow_run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/runtime/deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.runtime.deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/runtime/task_run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.runtime.task_run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/serializers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.serializers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.settings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.states
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/task-runners/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.task_runners
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_19" >
        
          <label class="md-nav__link" for="__nav_7_2_19" id="__nav_7_2_19_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Blocks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_19">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blocks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/blocks/core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.blocks.core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/blocks/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.blocks.kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/blocks/notifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.blocks.notifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/blocks/system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.blocks.system
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/blocks/webhook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.blocks.webhook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_20" >
        
          <label class="md-nav__link" for="__nav_7_2_20" id="__nav_7_2_20_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Client
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_20">
            <span class="md-nav__icon md-icon"></span>
            
  
    Client
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/client/base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.client.base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/client/cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.client.cloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/client/orchestration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.client.orchestration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/client/schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.client.schemas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/client/utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.client.utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_21" >
        
          <label class="md-nav__link" for="__nav_7_2_21" id="__nav_7_2_21_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Command Line Interface
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_21">
            <span class="md-nav__icon md-icon"></span>
            
  
    Command Line Interface
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.cloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/cloud-webhook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.cloud_webhook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/concurrency_limit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.concurrency_limit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.dev
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.profile
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.project
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/work_queue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.work_queue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/root/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.root
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/flow_run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.flow_run
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/cli/server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.cli.server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_22" >
        
          <label class="md-nav__link" for="__nav_7_2_22" id="__nav_7_2_22_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_22">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/utilities/annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.utilities.annotations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/utilities/asyncutils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.utilities.asyncutils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/utilities/processutils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.utilities.processutils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/utilities/callables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.utilities.callables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/utilities/collections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.utilities.collections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/utilities/filesystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.utilities.filesystem
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/utilities/hashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.utilities.hashing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2_23" >
        
          <label class="md-nav__link" for="__nav_7_2_23" id="__nav_7_2_23_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Workers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_23">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/workers/base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.workers.base
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../prefect/workers/process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    prefect.workers.process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../rest-api/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    REST API
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_7_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    REST API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://app.prefect.cloud/api/docs" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Prefect Cloud REST API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../rest-api-reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Prefect Server REST API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Server API
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_7_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Server API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_2" >
        
          <label class="md-nav__link" for="__nav_7_4_2" id="__nav_7_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/admin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.admin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.deployments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/flow_runs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.flow_runs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/flow_run_states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.flow_run_states
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/run_history/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.run_history
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/saved_searches/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.saved_searches
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/task_runs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.task_runs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../api/task_run_states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.api.task_run_states
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_3" >
        
          <label class="md-nav__link" for="__nav_7_4_3" id="__nav_7_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Models
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/flows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.models.flows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/flow_runs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.models.flow_runs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/flow_run_states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.models.flow_run_states
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/task_runs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.models.task_runs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/task_run_states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.models.task_run_states
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.models.deployments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/saved_searches/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.models.saved_searches
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_4" checked>
        
          <label class="md-nav__link" for="__nav_7_4_4" id="__nav_7_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Orchestration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Orchestration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.orchestration.rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../policies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.orchestration.policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    server.orchestration.core_policy
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    server.orchestration.core_policy
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CoreFlowPolicy" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoreFlowPolicy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CoreTaskPolicy" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoreTaskPolicy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.SecureTaskConcurrencySlots" class="md-nav__link">
    <span class="md-ellipsis">
      
        SecureTaskConcurrencySlots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.ReleaseTaskConcurrencySlots" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReleaseTaskConcurrencySlots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CacheInsertion" class="md-nav__link">
    <span class="md-ellipsis">
      
        CacheInsertion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CacheRetrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        CacheRetrieval
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.RetryFailedFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetryFailedFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.RetryFailedTasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetryFailedTasks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.RenameReruns" class="md-nav__link">
    <span class="md-ellipsis">
      
        RenameReruns
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CopyScheduledTime" class="md-nav__link">
    <span class="md-ellipsis">
      
        CopyScheduledTime
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.WaitForScheduledTime" class="md-nav__link">
    <span class="md-ellipsis">
      
        WaitForScheduledTime
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandlePausingFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandlePausingFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandleResumingPausedFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandleResumingPausedFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.UpdateFlowRunTrackerOnTasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        UpdateFlowRunTrackerOnTasks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandleTaskTerminalStateTransitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandleTaskTerminalStateTransitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandleFlowTerminalStateTransitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandleFlowTerminalStateTransitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.PreventPendingTransitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        PreventPendingTransitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.PreventRunningTasksFromStoppedFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        PreventRunningTasksFromStoppedFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.EnforceCancellingToCancelledTransition" class="md-nav__link">
    <span class="md-ellipsis">
      
        EnforceCancellingToCancelledTransition
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.BypassCancellingScheduledFlowRuns" class="md-nav__link">
    <span class="md-ellipsis">
      
        BypassCancellingScheduledFlowRuns
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../global_policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.orchestration.global_policy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_5" >
        
          <label class="md-nav__link" for="__nav_7_4_5" id="__nav_7_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Schemas
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Schemas
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schemas/actions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.schemas.actions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schemas/core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.schemas.core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schemas/filters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.schemas.filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schemas/responses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.schemas.responses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schemas/schedules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.schemas.schedules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schemas/sorting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.schemas.sorting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schemas/states/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.schemas.states
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_6" >
        
          <label class="md-nav__link" for="__nav_7_4_6" id="__nav_7_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../services/late_runs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.services.late_runs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../services/loop_service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.services.loop_service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../services/scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.services.scheduler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4_7" >
        
          <label class="md-nav__link" for="__nav_7_4_7" id="__nav_7_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.utilities.database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.utilities.schemas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    server.utilities.server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../community/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4 4 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.549-.514 3.507 3.507 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 5.5.75.75 0 0 1 11 4Zm-5.5-.5a2 2 0 1 0-.001 3.999A2 2 0 0 0 5.5 3.5Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Community
  

    
  </span>
  
  

            </a>
            
              <label class="md-nav__link " for="__nav_8">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Community
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Style
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/versioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Versioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/common-mistakes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CoreFlowPolicy" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoreFlowPolicy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CoreTaskPolicy" class="md-nav__link">
    <span class="md-ellipsis">
      
        CoreTaskPolicy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.SecureTaskConcurrencySlots" class="md-nav__link">
    <span class="md-ellipsis">
      
        SecureTaskConcurrencySlots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.ReleaseTaskConcurrencySlots" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReleaseTaskConcurrencySlots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CacheInsertion" class="md-nav__link">
    <span class="md-ellipsis">
      
        CacheInsertion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CacheRetrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        CacheRetrieval
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.RetryFailedFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetryFailedFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.RetryFailedTasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetryFailedTasks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.RenameReruns" class="md-nav__link">
    <span class="md-ellipsis">
      
        RenameReruns
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.CopyScheduledTime" class="md-nav__link">
    <span class="md-ellipsis">
      
        CopyScheduledTime
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.WaitForScheduledTime" class="md-nav__link">
    <span class="md-ellipsis">
      
        WaitForScheduledTime
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandlePausingFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandlePausingFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandleResumingPausedFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandleResumingPausedFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.UpdateFlowRunTrackerOnTasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        UpdateFlowRunTrackerOnTasks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandleTaskTerminalStateTransitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandleTaskTerminalStateTransitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.HandleFlowTerminalStateTransitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        HandleFlowTerminalStateTransitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.PreventPendingTransitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        PreventPendingTransitions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.PreventRunningTasksFromStoppedFlows" class="md-nav__link">
    <span class="md-ellipsis">
      
        PreventRunningTasksFromStoppedFlows
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.EnforceCancellingToCancelledTransition" class="md-nav__link">
    <span class="md-ellipsis">
      
        EnforceCancellingToCancelledTransition
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefect.server.orchestration.core_policy.BypassCancellingScheduledFlowRuns" class="md-nav__link">
    <span class="md-ellipsis">
      
        BypassCancellingScheduledFlowRuns
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                




  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
      
        
  
    
    
      <li class="md-path__item">
        <a href="../../../" class="md-path__link">
          
  <span class="md-ellipsis">
    API References
  </span>

        </a>
      </li>
    
  

      
        
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    Server API
  </span>

        </a>
      </li>
    
  

      
        
  
    
    
      <li class="md-path__item">
        <a href="../rules/" class="md-path__link">
          
  <span class="md-ellipsis">
    Orchestration
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/PrefectHQ/prefect/edit/main/docs/api-ref/server/orchestration/core_policy.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
    </a>
  
  


<div class="doc doc-object doc-module">



<h1 id="prefect.server.orchestration.core_policy" class="doc doc-heading">
            <code>prefect.server.orchestration.core_policy</code>


<a href="#prefect.server.orchestration.core_policy" class="headerlink" title="Permanent link">&para;</a></h1>

  <div class="doc doc-contents first">
  
      <p>Orchestration logic that fires on state transitions.</p>
<p><code>CoreFlowPolicy</code> and <code>CoreTaskPolicy</code> contain all default orchestration rules that 
Prefect enforces on a state transition.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.CoreFlowPolicy" class="doc doc-heading">
          <code>CoreFlowPolicy</code>


<a href="#prefect.server.orchestration.core_policy.CoreFlowPolicy" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.policies.BaseOrchestrationPolicy" href="../policies/#prefect.server.orchestration.policies.BaseOrchestrationPolicy">BaseOrchestrationPolicy</a></code></p>

  
      <p>Orchestration rules that run against flow-run-state transitions in priority order.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CoreFlowPolicy</span><span class="p">(</span><span class="n">BaseOrchestrationPolicy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orchestration rules that run against flow-run-state transitions in priority order.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">priority</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">HandleFlowTerminalStateTransitions</span><span class="p">,</span>
            <span class="n">EnforceCancellingToCancelledTransition</span><span class="p">,</span>
            <span class="n">BypassCancellingScheduledFlowRuns</span><span class="p">,</span>
            <span class="n">PreventPendingTransitions</span><span class="p">,</span>
            <span class="n">HandlePausingFlows</span><span class="p">,</span>
            <span class="n">HandleResumingPausedFlows</span><span class="p">,</span>
            <span class="n">CopyScheduledTime</span><span class="p">,</span>
            <span class="n">WaitForScheduledTime</span><span class="p">,</span>
            <span class="n">RetryFailedFlows</span><span class="p">,</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.CoreTaskPolicy" class="doc doc-heading">
          <code>CoreTaskPolicy</code>


<a href="#prefect.server.orchestration.core_policy.CoreTaskPolicy" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.policies.BaseOrchestrationPolicy" href="../policies/#prefect.server.orchestration.policies.BaseOrchestrationPolicy">BaseOrchestrationPolicy</a></code></p>

  
      <p>Orchestration rules that run against task-run-state transitions in priority order.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CoreTaskPolicy</span><span class="p">(</span><span class="n">BaseOrchestrationPolicy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orchestration rules that run against task-run-state transitions in priority order.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">priority</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">CacheRetrieval</span><span class="p">,</span>
            <span class="n">HandleTaskTerminalStateTransitions</span><span class="p">,</span>
            <span class="n">PreventRunningTasksFromStoppedFlows</span><span class="p">,</span>
            <span class="n">SecureTaskConcurrencySlots</span><span class="p">,</span>  <span class="c1"># retrieve cached states even if slots are full</span>
            <span class="n">CopyScheduledTime</span><span class="p">,</span>
            <span class="n">WaitForScheduledTime</span><span class="p">,</span>
            <span class="n">RetryFailedTasks</span><span class="p">,</span>
            <span class="n">RenameReruns</span><span class="p">,</span>
            <span class="n">UpdateFlowRunTrackerOnTasks</span><span class="p">,</span>
            <span class="n">CacheInsertion</span><span class="p">,</span>
            <span class="n">ReleaseTaskConcurrencySlots</span><span class="p">,</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.SecureTaskConcurrencySlots" class="doc doc-heading">
          <code>SecureTaskConcurrencySlots</code>


<a href="#prefect.server.orchestration.core_policy.SecureTaskConcurrencySlots" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Checks relevant concurrency slots are available before entering a Running state.</p>
<p>This rule checks if concurrency limits have been set on the tags associated with a
TaskRun. If so, a concurrency slot will be secured against each concurrency limit
before being allowed to transition into a running state. If a concurrency limit has
been reached, the client will be instructed to delay the transition for 30 seconds
before trying again. If the concurrency limit set on a tag is 0, the transition will
be aborted to prevent deadlocks.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SecureTaskConcurrencySlots</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks relevant concurrency slots are available before entering a Running state.</span>

<span class="sd">    This rule checks if concurrency limits have been set on the tags associated with a</span>
<span class="sd">    TaskRun. If so, a concurrency slot will be secured against each concurrency limit</span>
<span class="sd">    before being allowed to transition into a running state. If a concurrency limit has</span>
<span class="sd">    been reached, the client will be instructed to delay the transition for 30 seconds</span>
<span class="sd">    before trying again. If the concurrency limit set on a tag is 0, the transition will</span>
<span class="sd">    be aborted to prevent deadlocks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_applied_limits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filtered_limits</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">await</span> <span class="n">concurrency_limits</span><span class="o">.</span><span class="n">filter_concurrency_limits_for_orchestration</span><span class="p">(</span>
                <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">tags</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">run_limits</span> <span class="o">=</span> <span class="p">{</span><span class="n">limit</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span> <span class="n">limit</span> <span class="k">for</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">filtered_limits</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">run_limits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">concurrency_limit</span>
            <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># limits of 0 will deadlock, and the transition needs to abort</span>
                <span class="k">for</span> <span class="n">stale_tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_applied_limits</span><span class="p">:</span>
                    <span class="n">stale_limit</span> <span class="o">=</span> <span class="n">run_limits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stale_tag</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">active_slots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stale_limit</span><span class="o">.</span><span class="n">active_slots</span><span class="p">)</span>
                    <span class="n">active_slots</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                    <span class="n">stale_limit</span><span class="o">.</span><span class="n">active_slots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_slots</span><span class="p">)</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
                    <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The concurrency limit on tag &quot;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&quot; is 0 and will deadlock&#39;</span>
                        <span class="s2">&quot; if the task tries to run again.&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">active_slots</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
                <span class="c1"># if the limit has already been reached, delay the transition</span>
                <span class="k">for</span> <span class="n">stale_tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_applied_limits</span><span class="p">:</span>
                    <span class="n">stale_limit</span> <span class="o">=</span> <span class="n">run_limits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stale_tag</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">active_slots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stale_limit</span><span class="o">.</span><span class="n">active_slots</span><span class="p">)</span>
                    <span class="n">active_slots</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                    <span class="n">stale_limit</span><span class="o">.</span><span class="n">active_slots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_slots</span><span class="p">)</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_transition</span><span class="p">(</span>
                    <span class="mi">30</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Concurrency limit for the </span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2"> tag has been reached&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># log the TaskRun ID to active_slots</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_applied_limits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">active_slots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">active_slots</span><span class="p">)</span>
                <span class="n">active_slots</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">active_slots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_slots</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">OrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_applied_limits</span><span class="p">:</span>
            <span class="n">cl</span> <span class="o">=</span> <span class="k">await</span> <span class="n">concurrency_limits</span><span class="o">.</span><span class="n">read_concurrency_limit_by_tag</span><span class="p">(</span>
                <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">tag</span>
            <span class="p">)</span>
            <span class="n">active_slots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">active_slots</span><span class="p">)</span>
            <span class="n">active_slots</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="n">cl</span><span class="o">.</span><span class="n">active_slots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_slots</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.ReleaseTaskConcurrencySlots" class="doc doc-heading">
          <code>ReleaseTaskConcurrencySlots</code>


<a href="#prefect.server.orchestration.core_policy.ReleaseTaskConcurrencySlots" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseUniversalTransform" href="../rules/#prefect.server.orchestration.rules.BaseUniversalTransform">BaseUniversalTransform</a></code></p>

  
      <p>Releases any concurrency slots held by a run upon exiting a Running or
Cancelling state.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ReleaseTaskConcurrencySlots</span><span class="p">(</span><span class="n">BaseUniversalTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Releases any concurrency slots held by a run upon exiting a Running or</span>
<span class="sd">    Cancelling state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">after_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">OrchestrationContext</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nullified_transition</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">validated_state</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">validated_state</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">states</span><span class="o">.</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
            <span class="n">states</span><span class="o">.</span><span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLING</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">filtered_limits</span> <span class="o">=</span> <span class="p">(</span>
                <span class="k">await</span> <span class="n">concurrency_limits</span><span class="o">.</span><span class="n">filter_concurrency_limits_for_orchestration</span><span class="p">(</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">tags</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">run_limits</span> <span class="o">=</span> <span class="p">{</span><span class="n">limit</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span> <span class="n">limit</span> <span class="k">for</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">filtered_limits</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">run_limits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">active_slots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">active_slots</span><span class="p">)</span>
                <span class="n">active_slots</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
                <span class="n">cl</span><span class="o">.</span><span class="n">active_slots</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">active_slots</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.CacheInsertion" class="doc doc-heading">
          <code>CacheInsertion</code>


<a href="#prefect.server.orchestration.core_policy.CacheInsertion" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Caches completed states with cache keys after they are validated.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CacheInsertion</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Caches completed states with cache keys after they are validated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">]</span>

    <span class="nd">@inject_db</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">after_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
        <span class="n">db</span><span class="p">:</span> <span class="n">PrefectDBInterface</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validated_state</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">cache_key</span> <span class="o">=</span> <span class="n">validated_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">cache_key</span>
        <span class="k">if</span> <span class="n">cache_key</span><span class="p">:</span>
            <span class="n">new_cache_item</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">TaskRunStateCache</span><span class="p">(</span>
                <span class="n">cache_key</span><span class="o">=</span><span class="n">cache_key</span><span class="p">,</span>
                <span class="n">cache_expiration</span><span class="o">=</span><span class="n">validated_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">cache_expiration</span><span class="p">,</span>
                <span class="n">task_run_state_id</span><span class="o">=</span><span class="n">validated_state</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_cache_item</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.CacheRetrieval" class="doc doc-heading">
          <code>CacheRetrieval</code>


<a href="#prefect.server.orchestration.core_policy.CacheRetrieval" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Rejects running states if a completed state has been cached.</p>
<p>This rule rejects transitions into a running state with a cache key if the key
has already been associated with a completed state in the cache table. The client
will be instructed to transition into the cached completed state instead.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CacheRetrieval</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rejects running states if a completed state has been cached.</span>

<span class="sd">    This rule rejects transitions into a running state with a cache key if the key</span>
<span class="sd">    has already been associated with a completed state in the cache table. The client</span>
<span class="sd">    will be instructed to transition into the cached completed state instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>

    <span class="nd">@inject_db</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
        <span class="n">db</span><span class="p">:</span> <span class="n">PrefectDBInterface</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">cache_key</span>
        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">refresh_cache</span><span class="p">:</span>
            <span class="c1"># Check for cached states matching the cache key</span>
            <span class="n">cached_state_id</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">select</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">TaskRunStateCache</span><span class="o">.</span><span class="n">task_run_state_id</span><span class="p">)</span>
                <span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">sa</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span>
                        <span class="n">db</span><span class="o">.</span><span class="n">TaskRunStateCache</span><span class="o">.</span><span class="n">cache_key</span> <span class="o">==</span> <span class="n">cache_key</span><span class="p">,</span>
                        <span class="n">sa</span><span class="o">.</span><span class="n">or_</span><span class="p">(</span>
                            <span class="n">db</span><span class="o">.</span><span class="n">TaskRunStateCache</span><span class="o">.</span><span class="n">cache_expiration</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
                            <span class="n">db</span><span class="o">.</span><span class="n">TaskRunStateCache</span><span class="o">.</span><span class="n">cache_expiration</span> <span class="o">&gt;</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s2">&quot;utc&quot;</span><span class="p">),</span>
                        <span class="p">),</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">TaskRunStateCache</span><span class="o">.</span><span class="n">created</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
                <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">scalar_subquery</span><span class="p">()</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">TaskRunState</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">TaskRunState</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">cached_state_id</span><span class="p">)</span>
            <span class="n">cached_state</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">))</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cached_state</span><span class="p">:</span>
                <span class="n">new_state</span> <span class="o">=</span> <span class="n">cached_state</span><span class="o">.</span><span class="n">as_state</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">reset_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">new_state</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Cached&quot;</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">new_state</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Retrieved state from cache&quot;</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.RetryFailedFlows" class="doc doc-heading">
          <code>RetryFailedFlows</code>


<a href="#prefect.server.orchestration.core_policy.RetryFailedFlows" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Rejects failed states and schedules a retry if the retry limit has not been reached.</p>
<p>This rule rejects transitions into a failed state if <code>retries</code> has been
set and the run count has not reached the specified limit. The client will be
instructed to transition into a scheduled state to retry flow execution.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RetryFailedFlows</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rejects failed states and schedules a retry if the retry limit has not been reached.</span>

<span class="sd">    This rule rejects transitions into a failed state if `retries` has been</span>
<span class="sd">    set and the run count has not reached the specified limit. The client will be</span>
<span class="sd">    instructed to transition into a scheduled state to retry flow execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">FAILED</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">FlowOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_settings</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run_settings</span>
        <span class="n">run_count</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run_count</span>

        <span class="k">if</span> <span class="n">run_settings</span><span class="o">.</span><span class="n">retries</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">run_count</span> <span class="o">&gt;</span> <span class="n">run_settings</span><span class="o">.</span><span class="n">retries</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Retry count exceeded, allow transition to failed</span>

        <span class="n">scheduled_start_time</span> <span class="o">=</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">seconds</span><span class="o">=</span><span class="n">run_settings</span><span class="o">.</span><span class="n">retry_delay</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="p">)</span>

        <span class="c1"># support old-style flow run retries for older clients</span>
        <span class="c1"># older flow retries require us to loop over failed tasks to update their state</span>
        <span class="c1"># this is not required after API version 0.8.3</span>
        <span class="n">api_version</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api-version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">api_version</span> <span class="ow">and</span> <span class="n">api_version</span> <span class="o">&lt;</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;0.8.3&quot;</span><span class="p">):</span>
            <span class="n">failed_task_runs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">models</span><span class="o">.</span><span class="n">task_runs</span><span class="o">.</span><span class="n">read_task_runs</span><span class="p">(</span>
                <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                <span class="n">flow_run_filter</span><span class="o">=</span><span class="n">filters</span><span class="o">.</span><span class="n">FlowRunFilter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;any_&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">]}),</span>
                <span class="n">task_run_filter</span><span class="o">=</span><span class="n">filters</span><span class="o">.</span><span class="n">TaskRunFilter</span><span class="p">(</span>
                    <span class="n">state</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;any_&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;FAILED&quot;</span><span class="p">]}}</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">failed_task_runs</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">models</span><span class="o">.</span><span class="n">task_runs</span><span class="o">.</span><span class="n">set_task_run_state</span><span class="p">(</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="o">.</span><span class="n">AwaitingRetry</span><span class="p">(</span><span class="n">scheduled_time</span><span class="o">=</span><span class="n">scheduled_start_time</span><span class="p">),</span>
                    <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Reset the run count so that the task run retries still work correctly</span>
                <span class="n">run</span><span class="o">.</span><span class="n">run_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Reset pause metadata on retry</span>
        <span class="c1"># Pauses as a concept only exist after API version 0.8.4</span>
        <span class="n">api_version</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api-version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">api_version</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">api_version</span> <span class="o">&gt;=</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;0.8.4&quot;</span><span class="p">):</span>
            <span class="n">updated_policy</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">updated_policy</span><span class="p">[</span><span class="s2">&quot;resuming&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">updated_policy</span><span class="p">[</span><span class="s2">&quot;pause_keys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">FlowRunPolicy</span><span class="p">(</span><span class="o">**</span><span class="n">updated_policy</span><span class="p">)</span>

        <span class="c1"># Generate a new state for the flow</span>
        <span class="n">retry_state</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">AwaitingRetry</span><span class="p">(</span>
            <span class="n">scheduled_time</span><span class="o">=</span><span class="n">scheduled_start_time</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="n">proposed_state</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">proposed_state</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">retry_state</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Retrying&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.RetryFailedTasks" class="doc doc-heading">
          <code>RetryFailedTasks</code>


<a href="#prefect.server.orchestration.core_policy.RetryFailedTasks" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Rejects failed states and schedules a retry if the retry limit has not been reached.</p>
<p>This rule rejects transitions into a failed state if <code>retries</code> has been
set and the run count has not reached the specified limit. The client will be
instructed to transition into a scheduled state to retry task execution.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RetryFailedTasks</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rejects failed states and schedules a retry if the retry limit has not been reached.</span>

<span class="sd">    This rule rejects transitions into a failed state if `retries` has been</span>
<span class="sd">    set and the run count has not reached the specified limit. The client will be</span>
<span class="sd">    instructed to transition into a scheduled state to retry task execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">FAILED</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_settings</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run_settings</span>
        <span class="n">run_count</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run_count</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">run_settings</span><span class="o">.</span><span class="n">retry_delay</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">base_delay</span> <span class="o">=</span> <span class="n">delay</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">run_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_delay</span> <span class="o">=</span> <span class="n">run_settings</span><span class="o">.</span><span class="n">retry_delay</span> <span class="ow">or</span> <span class="mi">0</span>

        <span class="c1"># guard against negative relative jitter inputs</span>
        <span class="k">if</span> <span class="n">run_settings</span><span class="o">.</span><span class="n">retry_jitter_factor</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">clamped_poisson_interval</span><span class="p">(</span>
                <span class="n">base_delay</span><span class="p">,</span> <span class="n">clamping_factor</span><span class="o">=</span><span class="n">run_settings</span><span class="o">.</span><span class="n">retry_jitter_factor</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">base_delay</span>

        <span class="k">if</span> <span class="n">run_settings</span><span class="o">.</span><span class="n">retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">run_count</span> <span class="o">&lt;=</span> <span class="n">run_settings</span><span class="o">.</span><span class="n">retries</span><span class="p">:</span>
            <span class="n">retry_state</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">AwaitingRetry</span><span class="p">(</span>
                <span class="n">scheduled_time</span><span class="o">=</span><span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">delay</span><span class="p">),</span>
                <span class="n">message</span><span class="o">=</span><span class="n">proposed_state</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">proposed_state</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">retry_state</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Retrying&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.RenameReruns" class="doc doc-heading">
          <code>RenameReruns</code>


<a href="#prefect.server.orchestration.core_policy.RenameReruns" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Name the states if they have run more than once.</p>
<p>In the special case where the initial state is an "AwaitingRetry" scheduled state,
the proposed state will be renamed to "Retrying" instead.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RenameReruns</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Name the states if they have run more than once.</span>

<span class="sd">    In the special case where the initial state is an &quot;AwaitingRetry&quot; scheduled state,</span>
<span class="sd">    the proposed state will be renamed to &quot;Retrying&quot; instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_count</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run_count</span>
        <span class="k">if</span> <span class="n">run_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;AwaitingRetry&quot;</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_state</span><span class="p">(</span><span class="s2">&quot;Retrying&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_state</span><span class="p">(</span><span class="s2">&quot;Rerunning&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.CopyScheduledTime" class="doc doc-heading">
          <code>CopyScheduledTime</code>


<a href="#prefect.server.orchestration.core_policy.CopyScheduledTime" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Ensures scheduled time is copied from scheduled states to pending states.</p>
<p>If a new scheduled time has been proposed on the pending state, the scheduled time
on the scheduled state will be ignored.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CopyScheduledTime</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensures scheduled time is copied from scheduled states to pending states.</span>

<span class="sd">    If a new scheduled time has been proposed on the pending state, the scheduled time</span>
<span class="sd">    on the scheduled state will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">SCHEDULED</span><span class="p">]</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">PENDING</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">OrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">scheduled_time</span><span class="p">:</span>
            <span class="n">proposed_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">scheduled_time</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">initial_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">scheduled_time</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.WaitForScheduledTime" class="doc doc-heading">
          <code>WaitForScheduledTime</code>


<a href="#prefect.server.orchestration.core_policy.WaitForScheduledTime" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Prevents transitions to running states from happening to early.</p>
<p>This rule enforces that all scheduled states will only start with the machine clock
used by the Prefect REST API instance. This rule will identify transitions from scheduled
states that are too early and nullify them. Instead, no state will be written to the
database and the client will be sent an instruction to wait for <code>delay_seconds</code>
before attempting the transition again.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">WaitForScheduledTime</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prevents transitions to running states from happening to early.</span>

<span class="sd">    This rule enforces that all scheduled states will only start with the machine clock</span>
<span class="sd">    used by the Prefect REST API instance. This rule will identify transitions from scheduled</span>
<span class="sd">    states that are too early and nullify them. Instead, no state will be written to the</span>
<span class="sd">    database and the client will be sent an instruction to wait for `delay_seconds`</span>
<span class="sd">    before attempting the transition again.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">SCHEDULED</span><span class="p">,</span> <span class="n">StateType</span><span class="o">.</span><span class="n">PENDING</span><span class="p">]</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">OrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scheduled_time</span> <span class="o">=</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">scheduled_time</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scheduled_time</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># At this moment, we round delay to the nearest second as the API schema</span>
        <span class="c1"># specifies an integer return value.</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">scheduled_time</span> <span class="o">-</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
        <span class="n">delay_seconds</span> <span class="o">=</span> <span class="n">delay</span><span class="o">.</span><span class="n">in_seconds</span><span class="p">()</span>
        <span class="n">delay_seconds</span> <span class="o">+=</span> <span class="nb">round</span><span class="p">(</span><span class="n">delay</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delay_seconds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_transition</span><span class="p">(</span>
                <span class="n">delay_seconds</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Scheduled time is in the future&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.HandlePausingFlows" class="doc doc-heading">
          <code>HandlePausingFlows</code>


<a href="#prefect.server.orchestration.core_policy.HandlePausingFlows" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Governs runs attempting to enter a Paused state</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HandlePausingFlows</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Governs runs attempting to enter a Paused state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">PAUSED</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">initial_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span><span class="s2">&quot;Cannot pause flows with no state.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Cannot pause flows that are not currently running.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">pause_key</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if no pause key is provided, default to a UUID</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span><span class="o">.</span><span class="n">pause_keys</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;This pause has already fired.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">pause_reschedule</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">parent_task_run_id</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
                    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Cannot pause subflows with the reschedule option.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">deployment_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
                    <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                        <span class="s2">&quot;Cannot pause flows without a deployment with the reschedule&quot;</span>
                        <span class="s2">&quot; option.&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="k">return</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">after_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">updated_policy</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
        <span class="n">updated_policy</span><span class="p">[</span><span class="s2">&quot;pause_keys&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">FlowRunPolicy</span><span class="p">(</span><span class="o">**</span><span class="n">updated_policy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.HandleResumingPausedFlows" class="doc doc-heading">
          <code>HandleResumingPausedFlows</code>


<a href="#prefect.server.orchestration.core_policy.HandleResumingPausedFlows" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Governs runs attempting to leave a Paused state</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HandleResumingPausedFlows</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Governs runs attempting to leave a Paused state</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">PAUSED</span><span class="p">]</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span>
            <span class="ow">or</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_scheduled</span><span class="p">()</span>
            <span class="ow">or</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;This run cannot transition to the </span><span class="si">{</span><span class="n">proposed_state</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> state&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; from the </span><span class="si">{</span><span class="n">initial_state</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> state.&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">pause_reschedule</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                    <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Cannot reschedule a paused flow run without a deployment.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span>
        <span class="n">pause_timeout</span> <span class="o">=</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">state_details</span><span class="o">.</span><span class="n">pause_timeout</span>
        <span class="k">if</span> <span class="n">pause_timeout</span> <span class="ow">and</span> <span class="n">pause_timeout</span> <span class="o">&lt;</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s2">&quot;UTC&quot;</span><span class="p">):</span>
            <span class="n">pause_timeout_failure</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">Failed</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;The flow was paused and never resumed.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                <span class="n">state</span><span class="o">=</span><span class="n">pause_timeout_failure</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;The flow run pause has timed out and can no longer resume.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">after_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">updated_policy</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
        <span class="n">updated_policy</span><span class="p">[</span><span class="s2">&quot;resuming&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">FlowRunPolicy</span><span class="p">(</span><span class="o">**</span><span class="n">updated_policy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.UpdateFlowRunTrackerOnTasks" class="doc doc-heading">
          <code>UpdateFlowRunTrackerOnTasks</code>


<a href="#prefect.server.orchestration.core_policy.UpdateFlowRunTrackerOnTasks" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Tracks the flow run attempt a task run state is associated with.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UpdateFlowRunTrackerOnTasks</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tracks the flow run attempt a task run state is associated with.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">after_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_run</span> <span class="o">=</span> <span class="k">await</span> <span class="n">context</span><span class="o">.</span><span class="n">flow_run</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_run</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">flow_run_run_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_run</span><span class="o">.</span><span class="n">run_count</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ObjectNotFoundError</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Unable to read flow run associated with task run:&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">, this flow run might have been deleted&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.HandleTaskTerminalStateTransitions" class="doc doc-heading">
          <code>HandleTaskTerminalStateTransitions</code>


<a href="#prefect.server.orchestration.core_policy.HandleTaskTerminalStateTransitions" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>We do not allow tasks to leave terminal states if:
- The task is completed and has a persisted result
- The task is going to CANCELLING / PAUSED / CRASHED</p>
<p>We reset the run count when a task leaves a terminal state for a non-terminal state
which resets task run retries; this is particularly relevant for flow run retries.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HandleTaskTerminalStateTransitions</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We do not allow tasks to leave terminal states if:</span>
<span class="sd">    - The task is completed and has a persisted result</span>
<span class="sd">    - The task is going to CANCELLING / PAUSED / CRASHED</span>

<span class="sd">    We reset the run count when a task leaves a terminal state for a non-terminal state</span>
<span class="sd">    which resets task run retries; this is particularly relevant for flow run retries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">TERMINAL_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_run_count</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run_count</span>

        <span class="c1"># Do not allow runs to be marked as crashed, paused, or cancelling if already terminal</span>
        <span class="k">if</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLING</span><span class="p">,</span>
            <span class="n">StateType</span><span class="o">.</span><span class="n">PAUSED</span><span class="p">,</span>
            <span class="n">StateType</span><span class="o">.</span><span class="n">CRASHED</span><span class="p">,</span>
        <span class="p">}:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run is already </span><span class="si">{</span><span class="n">initial_state</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Only allow departure from a happily completed state if the result is not persisted</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">initial_state</span><span class="o">.</span><span class="n">is_completed</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">data</span>
            <span class="ow">and</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;unpersisted&quot;</span>
        <span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;This run is already completed.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_final</span><span class="p">():</span>
            <span class="c1"># Reset run count to reset retries</span>
            <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Change the name of the state to retrying if its a flow run retry</span>
        <span class="k">if</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_running</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flow_run</span> <span class="o">=</span> <span class="k">await</span> <span class="n">context</span><span class="o">.</span><span class="n">flow_run</span><span class="p">()</span>
            <span class="n">flow_retrying</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">flow_run_run_count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_run</span><span class="o">.</span><span class="n">run_count</span>
            <span class="k">if</span> <span class="n">flow_retrying</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_state</span><span class="p">(</span><span class="s2">&quot;Retrying&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">OrchestrationContext</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># reset run count</span>
        <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">run_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_run_count</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.HandleFlowTerminalStateTransitions" class="doc doc-heading">
          <code>HandleFlowTerminalStateTransitions</code>


<a href="#prefect.server.orchestration.core_policy.HandleFlowTerminalStateTransitions" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>We do not allow flows to leave terminal states if:
- The flow is completed and has a persisted result
- The flow is going to CANCELLING / PAUSED / CRASHED
- The flow is going to scheduled and has no deployment</p>
<p>We reset the pause metadata when a flow leaves a terminal state for a non-terminal
state. This resets pause behavior during manual flow run retries.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HandleFlowTerminalStateTransitions</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    We do not allow flows to leave terminal states if:</span>
<span class="sd">    - The flow is completed and has a persisted result</span>
<span class="sd">    - The flow is going to CANCELLING / PAUSED / CRASHED</span>
<span class="sd">    - The flow is going to scheduled and has no deployment</span>

<span class="sd">    We reset the pause metadata when a flow leaves a terminal state for a non-terminal</span>
<span class="sd">    state. This resets pause behavior during manual flow run retries.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">TERMINAL_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">FlowOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_flow_policy</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>

        <span class="c1"># Do not allow runs to be marked as crashed, paused, or cancelling if already terminal</span>
        <span class="k">if</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLING</span><span class="p">,</span>
            <span class="n">StateType</span><span class="o">.</span><span class="n">PAUSED</span><span class="p">,</span>
            <span class="n">StateType</span><span class="o">.</span><span class="n">CRASHED</span><span class="p">,</span>
        <span class="p">}:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Run is already in terminal state </span><span class="si">{</span><span class="n">initial_state</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Only allow departure from a happily completed state if the result is not</span>
        <span class="c1"># persisted and the a rerun is being proposed</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">initial_state</span><span class="o">.</span><span class="n">is_completed</span><span class="p">()</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_final</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">data</span>
            <span class="ow">and</span> <span class="n">initial_state</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;unpersisted&quot;</span>
        <span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Run is already COMPLETED.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Do not allows runs to be rescheduled without a deployment</span>
        <span class="k">if</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_scheduled</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
                <span class="s2">&quot;Cannot reschedule a run without an associated deployment.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">proposed_state</span><span class="o">.</span><span class="n">is_final</span><span class="p">():</span>
            <span class="c1"># Reset pause metadata when leaving a terminal state</span>
            <span class="n">api_version</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api-version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">api_version</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">api_version</span> <span class="o">&gt;=</span> <span class="n">Version</span><span class="p">(</span><span class="s2">&quot;0.8.4&quot;</span><span class="p">):</span>
                <span class="n">updated_policy</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
                <span class="n">updated_policy</span><span class="p">[</span><span class="s2">&quot;resuming&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">updated_policy</span><span class="p">[</span><span class="s2">&quot;pause_keys&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">FlowRunPolicy</span><span class="p">(</span><span class="o">**</span><span class="n">updated_policy</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">validated_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">OrchestrationContext</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">empirical_policy</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">FlowRunPolicy</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">original_flow_policy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.PreventPendingTransitions" class="doc doc-heading">
          <code>PreventPendingTransitions</code>


<a href="#prefect.server.orchestration.core_policy.PreventPendingTransitions" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Prevents transitions to PENDING.</p>
<p>This rule is only used for flow runs.</p>
<p>This is intended to prevent race conditions during duplicate submissions of runs.
Before a run is submitted to its execution environment, it should be placed in a
PENDING state. If two workers attempt to submit the same run, one of them should
encounter a PENDING -&gt; PENDING transition and abort orchestration of the run.</p>
<p>Similarly, if the execution environment starts quickly the run may be in a RUNNING
state when the second worker attempts the PENDING transition. We deny these state
changes as well to prevent duplicate submission. If a run has transitioned to a
RUNNING state a worker should not attempt to submit it again unless it has moved
into a terminal state.</p>
<p>CANCELLING and CANCELLED runs should not be allowed to transition to PENDING.
For re-runs of deployed runs, they should transition to SCHEDULED first.
For re-runs of ad-hoc runs, they should transition directly to RUNNING.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PreventPendingTransitions</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prevents transitions to PENDING.</span>

<span class="sd">    This rule is only used for flow runs.</span>

<span class="sd">    This is intended to prevent race conditions during duplicate submissions of runs.</span>
<span class="sd">    Before a run is submitted to its execution environment, it should be placed in a</span>
<span class="sd">    PENDING state. If two workers attempt to submit the same run, one of them should</span>
<span class="sd">    encounter a PENDING -&gt; PENDING transition and abort orchestration of the run.</span>

<span class="sd">    Similarly, if the execution environment starts quickly the run may be in a RUNNING</span>
<span class="sd">    state when the second worker attempts the PENDING transition. We deny these state</span>
<span class="sd">    changes as well to prevent duplicate submission. If a run has transitioned to a</span>
<span class="sd">    RUNNING state a worker should not attempt to submit it again unless it has moved</span>
<span class="sd">    into a terminal state.</span>

<span class="sd">    CANCELLING and CANCELLED runs should not be allowed to transition to PENDING.</span>
<span class="sd">    For re-runs of deployed runs, they should transition to SCHEDULED first.</span>
<span class="sd">    For re-runs of ad-hoc runs, they should transition directly to RUNNING.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">StateType</span><span class="o">.</span><span class="n">PENDING</span><span class="p">,</span>
        <span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLING</span><span class="p">,</span>
        <span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">,</span>
        <span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">PENDING</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">OrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
            <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;This run is in a </span><span class="si">{</span><span class="n">initial_state</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> state and cannot&quot;</span>
                <span class="s2">&quot; transition to a PENDING state.&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.PreventRunningTasksFromStoppedFlows" class="doc doc-heading">
          <code>PreventRunningTasksFromStoppedFlows</code>


<a href="#prefect.server.orchestration.core_policy.PreventRunningTasksFromStoppedFlows" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Prevents running tasks from stopped flows.</p>
<p>A running state implies execution, but also the converse. This rule ensures that a
flow's tasks cannot be run unless the flow is also running.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PreventRunningTasksFromStoppedFlows</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prevents running tasks from stopped flows.</span>

<span class="sd">    A running state implies execution, but also the converse. This rule ensures that a</span>
<span class="sd">    flow&#39;s tasks cannot be run unless the flow is also running.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">[</span><span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">flow_run</span> <span class="o">=</span> <span class="k">await</span> <span class="n">context</span><span class="o">.</span><span class="n">flow_run</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;The enclosing flow must be running to begin task execution.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">StateType</span><span class="o">.</span><span class="n">PAUSED</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                <span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="o">.</span><span class="n">Paused</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;NotReady&quot;</span><span class="p">),</span>
                <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                    <span class="s2">&quot;The flow is paused, new tasks can execute after resuming flow&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; run: </span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">StateType</span><span class="o">.</span><span class="n">RUNNING</span><span class="p">:</span>
            <span class="c1"># task runners should abort task run execution</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">abort_transition</span><span class="p">(</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;The enclosing flow must be running to begin task execution.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.EnforceCancellingToCancelledTransition" class="doc doc-heading">
          <code>EnforceCancellingToCancelledTransition</code>


<a href="#prefect.server.orchestration.core_policy.EnforceCancellingToCancelledTransition" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Rejects transitions from Cancelling to any terminal state except for Cancelled.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EnforceCancellingToCancelledTransition</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rejects transitions from Cancelling to any terminal state except for Cancelled.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">{</span><span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">,</span> <span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLING</span><span class="p">}</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="n">ALL_ORCHESTRATION_STATES</span> <span class="o">-</span> <span class="p">{</span><span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">TaskOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
            <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;Cannot transition flows that are cancelling to a state other &quot;</span>
                <span class="s2">&quot;than Cancelled.&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="prefect.server.orchestration.core_policy.BypassCancellingScheduledFlowRuns" class="doc doc-heading">
          <code>BypassCancellingScheduledFlowRuns</code>


<a href="#prefect.server.orchestration.core_policy.BypassCancellingScheduledFlowRuns" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="prefect.server.orchestration.rules.BaseOrchestrationRule" href="../rules/#prefect.server.orchestration.rules.BaseOrchestrationRule">BaseOrchestrationRule</a></code></p>

  
      <p>Rejects transitions from Scheduled to Cancelling, and instead sets the state to Cancelled,
if the flow run has no associated infrastructure process ID.</p>
<p>The <code>Cancelling</code> state is used to clean up infrastructure. If there is not infrastructure
to clean up, we can transition directly to <code>Cancelled</code>. Runs that are <code>AwaitingRetry</code> are
a <code>Scheduled</code> state that may have associated infrastructure.</p>

            <details class="quote">
              <summary>Source code in <code>/home/runner/work/docs/docs/prefect_source/src/prefect/server/orchestration/core_policy.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BypassCancellingScheduledFlowRuns</span><span class="p">(</span><span class="n">BaseOrchestrationRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rejects transitions from Scheduled to Cancelling, and instead sets the state to Cancelled,</span>
<span class="sd">    if the flow run has no associated infrastructure process ID.</span>

<span class="sd">    The `Cancelling` state is used to clean up infrastructure. If there is not infrastructure</span>
<span class="sd">    to clean up, we can transition directly to `Cancelled`. Runs that are `AwaitingRetry` are</span>
<span class="sd">    a `Scheduled` state that may have associated infrastructure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">FROM_STATES</span> <span class="o">=</span> <span class="p">{</span><span class="n">StateType</span><span class="o">.</span><span class="n">SCHEDULED</span><span class="p">}</span>
    <span class="n">TO_STATES</span> <span class="o">=</span> <span class="p">{</span><span class="n">StateType</span><span class="o">.</span><span class="n">CANCELLING</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">before_transition</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">proposed_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">states</span><span class="o">.</span><span class="n">State</span><span class="p">],</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">FlowOrchestrationContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">infrastructure_pid</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reject_transition</span><span class="p">(</span>
                <span class="n">state</span><span class="o">=</span><span class="n">states</span><span class="o">.</span><span class="n">Cancelled</span><span class="p">(),</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Scheduled flow run has no infrastructure to terminate.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>



  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thank you for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thank you for your feedback! Feel free to <a href="https://github.com/PrefectHQ/prefect/issues/new?assignees=&amp;labels=docs%2Cstatus%3Atriage&amp;projects=&amp;template=4_docs_change.yaml" target="_blank" rel="noopener"> open an issue </a> with more detail.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs Insiders
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.code.copy", "navigation.tabs.sticky", "search.suggest", "search.highlight", "navigation.path", "navigation.indexes", "content.tabs.link"], "search": "../../../../assets/javascripts/workers/search.6c7302c4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.7c5c0157.min.js"></script>
      
        
          <script src="../../../../js/custom.js"></script>
        
      
        
          <script src="../../../../js/termynal.js"></script>
        
      
    
  </body>
</html>